<div class="min-h-screen bg-[#1c1c2e] text-white font-sans pb-28 relative overflow-hidden selection:bg-[#ff7043]/30 selection:text-white">
  
  <div class="fixed inset-0 pointer-events-none overflow-hidden">
    <div class="absolute top-[-20%] left-[-20%] w-[600px] h-[600px] bg-purple-600/15 rounded-full blur-[150px]"></div>
    <div class="absolute bottom-[-20%] right-[-20%] w-[600px] h-[600px] bg-orange-500/10 rounded-full blur-[150px]"></div>
  </div>

  <header class="px-5 pt-safe-top relative z-20">
    <div class="flex justify-between items-center pt-12 pb-4">
      <div>
        <p class="text-gray-400 text-sm">{{ greeting() }},</p>
        <h1 class="text-xl font-bold">
          {{ auth.username() || 'Willkommen' }} üëã
        </h1>
      </div>
      
      <button 
        (click)="showCitySelector.set(!showCitySelector())"
        class="flex items-center gap-2 bg-white/5 hover:bg-white/10 px-4 py-2 rounded-xl border border-white/10 transition-all">
        <svg class="w-4 h-4 text-[#ff7043]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <span class="text-sm font-medium">{{ selectedCity() }}</span>
        <svg class="w-4 h-4 text-gray-400 transition-transform" 
             [class.rotate-180]="showCitySelector()"
             fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>
    </div>

    @if (showCitySelector()) {
      <div class="absolute top-24 right-5 bg-[#2e2e42] rounded-2xl border border-white/10 shadow-2xl overflow-hidden z-50 animate-slide-down min-w-[180px]">
        @for (city of cities; track city) {
          <button 
            (click)="selectCity(city)"
            class="w-full px-4 py-3 text-left text-sm hover:bg-white/5 transition-colors flex items-center gap-3"
            [class.bg-white/5]="selectedCity() === city"
            [class.text-[#ff7043]]="selectedCity() === city">
            @if (selectedCity() === city) {
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
            } @else {
              <span class="w-4"></span>
            }
            {{ city }}
          </button>
        }
      </div>
    }

    <div class="relative group mb-6">
      <input 
        type="text" 
        placeholder="Aktivit√§t suchen..." 
        [value]="searchQuery()"
        (input)="onSearchInput($event)"
        class="w-full bg-[#2e2e42] text-gray-200 placeholder-gray-500 rounded-2xl py-3.5 pl-12 pr-4 border border-white/5 focus:outline-none focus:border-[#ff7043]/50 focus:bg-[#34344b] transition-all shadow-lg">
      <svg class="w-5 h-5 text-gray-500 absolute left-4 top-1/2 -translate-y-1/2 transition-colors group-focus-within:text-[#ff7043]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
    </div>
  </header>

  <section class="mb-6 overflow-x-auto no-scrollbar pl-5 relative z-10">
    <div class="flex gap-4 pr-5">
      @for (cat of categories(); track trackByCategoryId($index, cat)) {
        <button 
          (click)="filterByCategory(cat)"
          class="flex flex-col items-center gap-2 flex-shrink-0 cursor-pointer group">
          <div class="w-[68px] h-[68px] rounded-2xl overflow-hidden border-2 transition-all relative shadow-md"
               [class.border-[#ff7043]]="activeFilters().category === cat.id"
               [class.border-transparent]="activeFilters().category !== cat.id"
               [class.scale-105]="activeFilters().category === cat.id">
            <img [src]="cat.iconUrl" 
                 [alt]="cat.name"
                 class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500"
                 loading="lazy">
            <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
            <span class="absolute bottom-1 left-1/2 -translate-x-1/2 text-lg">{{ cat.icon }}</span>
          </div>
          <span class="text-[11px] font-medium transition-colors"
                [class.text-white]="activeFilters().category === cat.id"
                [class.text-gray-400]="activeFilters().category !== cat.id">
            {{ cat.name }}
          </span>
        </button>
      }
    </div>
  </section>

  <div class="px-5 mb-4 flex justify-between items-end relative z-10">
    <div>
      <h2 class="text-lg font-bold text-white">In deiner N√§he</h2>
      <p class="text-xs text-gray-500">{{ groups().length }} Aktivit√§ten gefunden</p>
    </div>
    <button 
      (click)="refresh()"
      class="text-xs text-[#ff7043] font-semibold hover:text-[#ff8a65] transition-colors flex items-center gap-1">
      <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
      </svg>
      Aktualisieren
    </button>
  </div>

  <main class="px-4 relative z-10 pb-4">
    
    @if (isLoading()) {
      <div class="grid grid-cols-2 gap-3">
        @for (i of [1,2,3,4]; track i) {
          <app-skeleton-card />
        }
      </div>
    }
    
    @else if (!hasGroups()) {
      <div class="flex flex-col items-center justify-center py-16 text-center">
        <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-4">
          <svg class="w-10 h-10 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
          </svg>
        </div>
        <h3 class="text-lg font-semibold mb-2">Keine Aktivit√§ten gefunden</h3>
        <p class="text-sm text-gray-400 mb-6 max-w-[250px]">
          @if (searchQuery()) {
            Keine Ergebnisse f√ºr "{{ searchQuery() }}". Versuche einen anderen Suchbegriff.
          } @else {
            Sei der Erste und erstelle eine Aktivit√§t in {{ selectedCity() }}!
          }
        </p>
        <button 
          (click)="openCreateModal()"
          class="btn-jamie btn-primary">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Aktivit√§t erstellen
        </button>
      </div>
    }
    
    @else {
      <div class="grid grid-cols-2 gap-3">
        @for (group of groups(); track trackByGroupId($index, group)) {
          <article 
            (click)="openGroup(group)"
            class="bg-[#2e2e42] rounded-2xl overflow-hidden relative shadow-lg hover:shadow-orange-500/10 active:scale-[0.98] transition-all cursor-pointer border border-white/5 group">
            
            <div class="h-32 sm:h-36 w-full relative overflow-hidden">
              <img [src]="group.imageUrl" 
                   [alt]="group.title"
                   class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                   loading="lazy">
              <div class="absolute inset-0 bg-gradient-to-t from-[#2e2e42] via-transparent to-transparent opacity-80"></div>
              
              <div class="absolute top-2 right-2 bg-black/50 backdrop-blur-md px-2.5 py-1 rounded-lg border border-white/10 flex items-center gap-1.5">
                <svg class="w-3 h-3 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                </svg>
                <span class="text-[10px] text-white font-bold">{{ group.currentMembers }}/{{ group.maxMembers }}</span>
              </div>

              <div class="absolute top-2 left-2 bg-[#ff7043]/90 px-2 py-0.5 rounded-md">
                <span class="text-[9px] text-white font-bold uppercase tracking-wider">{{ group.category }}</span>
              </div>
            </div>

            <div class="p-3 relative">
              <h3 class="text-sm font-bold text-white leading-tight mb-1 line-clamp-1">{{ group.title }}</h3>
              
              <div class="flex items-center gap-1 text-[10px] text-gray-400 mb-2">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <span>{{ group.date | date:'dd.MM. HH:mm' }}</span>
                <span class="text-gray-600">‚Ä¢</span>
                <span class="line-clamp-1">{{ group.location }}</span>
              </div>
              
              <div class="flex items-center justify-between">
                <div class="flex -space-x-2">
                  @for (seed of group.avatarSeeds.slice(0, 3); track seed) {
                    <div class="w-6 h-6 rounded-full border-2 border-[#2e2e42] bg-gray-700 overflow-hidden">
                      <img [src]="'https://api.dicebear.com/7.x/avataaars/svg?seed=' + seed" 
                           alt="Member"
                           class="w-full h-full">
                    </div>
                  }
                  @if (group.currentMembers > 3) {
                    <div class="w-6 h-6 rounded-full border-2 border-[#2e2e42] bg-[#3e3e52] flex items-center justify-center">
                      <span class="text-[8px] text-gray-300 font-bold">+{{ group.currentMembers - 3 }}</span>
                    </div>
                  }
                </div>
                
                <div class="w-7 h-7 rounded-full bg-[#3e3e52] flex items-center justify-center text-gray-300 group-hover:bg-[#ff7043] group-hover:text-white transition-colors">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
              </div>
            </div>
          </article>
        }
      </div>
    }
  </main>

  <nav class="fixed bottom-0 left-0 right-0 z-40">
    <div class="mx-4 mb-4 h-[68px] bg-[#252538]/95 backdrop-blur-xl rounded-[24px] flex justify-between items-center px-5 shadow-2xl border border-white/10 safe-bottom">
      
      <button class="p-2.5 text-[#ff7043]" aria-label="Home">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
      </button>
      
      <button class="p-2.5 text-gray-400 hover:text-white transition-colors" aria-label="Explore">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </button>
      
      <button 
        (click)="openCreateModal()" 
        class="relative -top-5 bg-gradient-to-tr from-[#ff8a65] to-[#ff7043] w-14 h-14 rounded-full shadow-lg shadow-orange-500/40 flex items-center justify-center text-white transform transition-all hover:scale-105 active:scale-95 border-4 border-[#1c1c2e]"
        aria-label="Create Activity">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"/>
        </svg>
      </button>

      <button class="p-2.5 text-gray-400 hover:text-white transition-colors relative" aria-label="Messages">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
        </svg>
        <span class="absolute top-1.5 right-1.5 w-2 h-2 bg-[#ff7043] rounded-full"></span>
      </button>
      
      <button class="p-2.5 text-gray-400 hover:text-white transition-colors" aria-label="Profile">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
      </button>
    </div>
  </nav>

  @if (selectedGroup()) {
    <app-join-modal 
      [group]="selectedGroup()!" 
      (close)="closeGroup()">
    </app-join-modal>
  }
  
  @if (isCreateModalOpen()) {
    <app-create-modal 
      (close)="closeCreateModal()"
      (created)="closeCreateModal()">
    </app-create-modal>
  }

  @if (showCitySelector()) {
    <div 
      class="fixed inset-0 z-30" 
      (click)="showCitySelector.set(false)">
    </div>
  }
</div>